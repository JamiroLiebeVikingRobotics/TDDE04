# Skriv namn på de som lämnat in här i kommentaren för enklare tillgång: Rasmus och Jamiro DPU1.C

import bpy 
from mathutils import Vector
from random import uniform


up = Vector((0.0, 0.0, 1.0))
planet = bpy.data.objects["planet"]
blomma = bpy.data.objects["blomma"]
flowerList = list(bpy.data.collections["add"].objects)
flowerPos = []

help = bpy.data.texts["helper"].as_module()

#if len(list(bpy.data.collections["add"].objects)) > 0:
 #   help.clean("add")
    
    
def distance_vec(point1: Vector, point2: Vector) -> float:
    return (point2 - point1).length 


def randomray():
    r = Vector((uniform(-1,1),uniform(-1,1),uniform(-1,1)))
    while r.magnitude == 0.0:
        r = Vector((uniform(-1,1),uniform(-1,1),uniform(-1,1)))
    r.normalize()
    return r

#print(distance_vec(flowerList[0].location,flowerList[159].location))

while len(flowerList) < 200:
    rand_ray = randomray()

    dp = bpy.context.view_layer.depsgraph
    begin = planet.location + rand_ray*10
    direction = planet.location - begin

    res = bpy.context.scene.ray_cast(dp, begin, direction)
    hit, loc, norm, poly_ind, obj, mtrx = res

    #print(planet.data.polygons[poly_ind].material_index)
 
    if len(flowerList) == 0:
        if hit and planet.data.polygons[poly_ind].material_index == 0:
            up = Vector((0.0, 0.0, 1.0))
            help.copy_obj(blomma, "add", loc.copy(), norm)
            
#    elif hit and planet.data.polygons[poly_ind].material_index == 0 and distance_vec(flowerList[-1]-location, loc) > 0.4:
#        up = Vector((0.0, 0.0, 1.0))
#        help.copy_obj(blomma, "add", loc.copy(), norm)

            
        
